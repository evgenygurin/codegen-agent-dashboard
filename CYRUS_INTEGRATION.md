# Cyrus AI Agent Integration

## Обзор

Cyrus - это автономный агент разработки на основе Claude Code для Linear, который автоматически обрабатывает issues и создает PR. Мы интегрировали Cyrus с нашим Codegen Agent Dashboard для создания полноценной платформы автономной разработки.

## Что такое Cyrus?

Cyrus - это AI-агент, который:

- **Мониторит Linear issues** назначенные пользователю
- **Создает изолированные Git worktrees** для каждого issue
- **Запускает Claude Code сессии** для обработки issues
- **Публикует ответы обратно в Linear** как комментарии
- **Создает PR в GitHub** автоматически

## Архитектура Cyrus

```
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│   Linear API    │───▶│  Cyrus Agent     │───▶│  Claude Code    │
│   (Webhooks)    │    │  (Edge Worker)   │    │  (AI Processing)│
└─────────────────┘    └──────────────────┘    └─────────────────┘
                                │
                                ▼
                       ┌──────────────────┐
                       │   Git Repository │
                       │   (Worktrees)    │
                       └──────────────────┘
```

## Интеграция с Dashboard

### 1. Компоненты

- **CyrusIntegration**: Основной компонент управления Cyrus
- **API Endpoints**: `/api/cyrus/status` для управления состоянием
- **React Hooks**: `useCyrusStatus`, `useToggleCyrus`, `useToggleRepository`

### 2. Функциональность

#### Управление агентом

- Запуск/остановка Cyrus агента
- Мониторинг статуса в реальном времени
- Просмотр статистики (активные issues, обработанные, ошибки)

#### Конфигурация репозиториев

- Добавление/удаление репозиториев
- Настройка маршрутизации по командам и проектам
- Конфигурация прав доступа и инструментов

#### Правила маршрутизации

- **Team Routing**: Маршрутизация по командам Linear
- **Project Routing**: Маршрутизация по проектам
- **Label Routing**: Маршрутизация по лейблам

#### Мониторинг

- Реальное время активности
- История обработки issues
- Логи ошибок и предупреждений

### 3. Безопасность

Cyrus поддерживает детальную настройку прав доступа:

```json
{
  "allowedTools": [
    "Read(**)",           // Чтение файлов
    "Edit(**)",           // Редактирование файлов
    "Bash(git:*)",        // Git команды
    "Bash(gh:*)",         // GitHub CLI
    "Task",               // Управление задачами
    "WebSearch",          // Веб поиск
    "mcp__linear"         // Linear MCP
  ]
}
```

**Предустановленные профили:**

- `"readOnly"`: Только чтение (7 инструментов)
- `"safe"`: Все кроме Bash (10 инструментов)
- `"all"`: Все инструменты включая Bash (11 инструментов)

## Настройка

### 1. Установка Cyrus

```bash
npm install -g cyrus-ai
```

### 2. Конфигурация

Создайте файл `~/.cyrus/config.json`:

```json
{
  "repositories": [
    {
      "id": "repo1",
      "name": "Main Repository",
      "repositoryPath": "/path/to/repo",
      "baseBranch": "main",
      "linearWorkspaceId": "workspace-id",
      "isActive": true,
      "allowedTools": ["Read(**)", "Edit(**)", "Bash(git:*)", "Task"],
      "teamKeys": ["BACKEND", "FRONTEND"],
      "projectKeys": ["API Service", "Web Platform"],
      "routingLabels": ["backend", "frontend", "api"]
    }
  ]
}
```

### 3. Переменные окружения

```bash
# Server configuration
CYRUS_SERVER_PORT=3456
CYRUS_BASE_URL=https://your-domain.com

# Linear OAuth (автоматически настраивается)
# Claude API keys (автоматически настраивается)
```

## Использование

### 1. Запуск Cyrus

```bash
cyrus
```

### 2. Управление через Dashboard

1. Откройте вкладку "Cyrus" в dashboard
2. Настройте репозитории и правила маршрутизации
3. Запустите агента кнопкой "Start Cyrus"
4. Мониторьте активность в реальном времени

### 3. Автоматическая обработка

После запуска Cyrus будет:

- Мониторить назначенные Linear issues
- Создавать изолированные ветки для каждого issue
- Обрабатывать issues с помощью Claude Code
- Публиковать результаты обратно в Linear
- Создавать PR в GitHub при необходимости

## Режимы работы

Cyrus поддерживает разные режимы в зависимости от лейблов:

### Debugger Mode

- **Лейблы**: Bug, Hotfix
- **Инструменты**: Все доступные
- **Цель**: Систематическое исследование проблем

### Builder Mode

- **Лейблы**: Feature, Improvement
- **Инструменты**: Безопасные инструменты
- **Цель**: Реализация функций

### Scoper Mode

- **Лейблы**: PRD, Design
- **Инструменты**: Только чтение + Linear MCP
- **Цель**: Анализ требований

## Мониторинг

Dashboard предоставляет:

- **Статистика в реальном времени**
- **История активности**
- **Логи ошибок**
- **Статус репозиториев**
- **Конфигурация инструментов**

## Безопасность и лучшие практики

1. **Ограничьте права доступа** - используйте профили "readOnly" или "safe"
2. **Настройте маршрутизацию** - разделите работу по командам/проектам
3. **Мониторьте активность** - регулярно проверяйте логи
4. **Тестируйте на dev окружении** - перед использованием в production
5. **Резервное копирование** - настройте автоматические бэкапы

## Интеграция с Codegen

Cyrus отлично дополняет Codegen:

- **Codegen**: Автоматический анализ и исправление кода
- **Cyrus**: Автономная обработка Linear issues
- **Dashboard**: Единая точка управления всеми агентами

## Поддержка

- **GitHub**: <https://github.com/ceedaragents/cyrus>
- **Документация**: <https://docs.ceedar.ai/cyrus>
- **Ceedar Pro**: Приоритетная поддержка и облачные сервисы

## Лицензия

MIT License - см. файл LICENSE в репозитории Cyrus.

---

*Последнее обновление: 29 сентября 2025*
